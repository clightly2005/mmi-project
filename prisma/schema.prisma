generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model application {
  id         Int                @id @default(autoincrement())
  userId     Int
  projectId  Int
  matchScore Float?
  status     applicationStatus @default(PENDING)
  appliedAt  DateTime           @default(now())
  project    project            @relation(fields: [projectId], references: [id], map: "Application_projectId_fkey")
  user       user               @relation(fields: [userId], references: [id], map: "Application_userId_fkey")

  @@index([projectId], map: "Application_projectId_fkey")
  @@index([userId], map: "Application_userId_fkey")
}



enum ProficiencyLevel {
  BEGINNER
  NOVICE
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model engineerSkill {
  id          Int   @id @default(autoincrement())
  userId      Int
  skillId     Int
  proficiency ProficiencyLevel
  skill       skill @relation(fields: [skillId], references: [id], map: "EngineerSkill_skillId_fkey")
  user        user  @relation(fields: [userId], references: [id], map: "EngineerSkill_userId_fkey")

  @@index([skillId], map: "engineerSkill_skillId_fkey")
  @@index([userId], map: "engineerSkill_userId_fkey")
}

model project {
  id                Int                 @id @default(autoincrement())
  title             String
  description       String
  durationWeeks     Int
  startDate         DateTime?
  ownerId           Int
  createdAt         DateTime            @default(now())
  application       application[]
  user              user                @relation(fields: [ownerId], references: [id], map: "Project_ownerId_fkey")
  projectAssignment projectAssignment[]
  projectSkill      projectSkill[]

  @@index([ownerId], map: "Project_ownerId_fkey")
}

model projectAssignment {
  id        Int      @id @default(autoincrement())
  userId    Int
  projectId Int
  startDate DateTime
  endDate   DateTime
  project   project  @relation(fields: [projectId], references: [id], map: "ProjectAssignment_projectId_fkey")
  user      user     @relation(fields: [userId], references: [id], map: "ProjectAssignment_userId_fkey")

  @@index([projectId], map: "ProjectAssignment_projectId_fkey")
  @@index([userId], map: "ProjectAssignment_userId_fkey")
}

model projectSkill {
  id        Int     @id @default(autoincrement())
  projectId Int
  skillId   Int
  minLevel  Int
  project   project @relation(fields: [projectId], references: [id], map: "ProjectSkill_projectId_fkey")
  skill     skill   @relation(fields: [skillId], references: [id], map: "ProjectSkill_skillId_fkey")

  @@index([projectId], map: "ProjectSkill_projectId_fkey")
  @@index([skillId], map: "ProjectSkill_skillId_fkey")
}

model skill {
  id            Int             @id @default(autoincrement())
  name          String          @unique(map: "Skill_name_key")
  engineerSkill engineerSkill[]
  projectSkill  projectSkill[]
}

model user {
  id                Int                 @id @default(autoincrement())
  name              String
  email             String              @unique(map: "User_email_key")
  createdAt         DateTime            @default(now())
  role              userRole
  firebaseUid       String              @unique(map: "User_firebaseUid_key")
  engineerRoleId    Int?
  engineerRole      engineerRole?       @relation(fields: [engineerRoleId], references: [id])
  application       application[]
  engineerSkill     engineerSkill[]
  project           project[]
  projectAssignment projectAssignment[]

  @@index([engineerRoleId], map: "User_engineerRoleId_fkey")
}

enum applicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum userRole {
  ENGINEER
  PM
}

model engineerRole {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users user[]   
}
